@using System.Net
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using HtmlAgilityPack

@inject DiceCombatsService CombatService
@inject NavigationManager Navigation

<h3>CreatureEditor</h3>


@if (creature == null)
{
    <p>@(CreatureGuid) does not exist</p>
} else
{
    <h1>@creature.Name</h1>
    <div style="padding:10px">
        @if (creature.ImageSheetBas64 != string.Empty)
        {
            <img src="@creature.ImageSheetBas64" height="400px" />
        } else if (creature.HtmlSheet != string.Empty)
        {
            @((MarkupString)creature.HtmlSheet)
        } else
        {
            <p>Could not render creature sheet</p>
        }
    </div>
    <div style="padding:10px;">
        <MudNumericField @bind-Value="creature.MaxHitPoints" Label="Maximum hit points (always present)" Variant="Variant.Outlined" Step="1" />
    </div>
    <div style="padding:10px;">
        <MudNumericField @bind-Value="creature.CurrentHitPoints" Label="Current hit points (always present)" Variant="Variant.Outlined" Step="1" Disabled="true" />
    </div>
    <div style="padding:10px;">
        <CreatureCustomFieldsEditor Fields="creature.CustomFields" />
    </div>
}




@code {
    [Parameter]
    public string CreatureGuid { get; set; } = default!;


    private DCCreature? creature = null;

    protected override void OnInitialized()
    {
        creature = CombatService.GetCreatureFromGUID(CreatureGuid);
        base.OnInitialized();
    }
}
