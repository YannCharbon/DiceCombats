@using DiceCombats
@using MudBlazor.Utilities
@inject DiceCombatsService CombatService
@inject IStringLocalizer<Resources.Localization.CreatureCustomFieldRenderer> Loc

@if (EditionMode)
{
    <div class="d-flex flex-wrap gap-2">
        <MudNumericField Style="max-width:150px;" @bind-Value="Field.Columns" Label="@Loc["CBGridHorizontal"]" Variant="Variant.Outlined" Min="1" />
        <MudNumericField Style="max-width:150px;" @bind-Value="Field.Rows" Label="@Loc["CBGridVertical"]" Variant="Variant.Outlined" Min="1" />
        <MudCheckBox T="bool" @bind-Value="Field.HasColumnHeaders" Label="@Loc["CBGridColumnLabels"]"></MudCheckBox>
        <MudCheckBox T="bool" @bind-Value="Field.HasRowHeaders" Label="@Loc["CBGridRowLabels"]"></MudCheckBox>
    </div>

    <div style="padding:10px;overflow-x:auto;">
        <table>
            @if (Field.HasColumnHeaders)
            {
                <tr>
                    @if (Field.HasRowHeaders)
                    {
                        <td>&nbsp;</td>
                    }
                    @foreach (int i in Enumerable.Range(0, Field.ColumnHeaders.Count))
                    {
                        <td><MudTextField style="min-width:100px;" Immediate="true" @bind-Value="Field.ColumnHeaders[i]" Label="@Loc["CBGridColumnName"]" Variant="Variant.Outlined" /></td>
                    }
                </tr>
            }
            @foreach (int i in Enumerable.Range(0, Field.Rows))
            {
                <tr>
                    @if (Field.HasRowHeaders)
                    {
                        <td><MudTextField style="min-width:100px;" Immediate="true" @bind-Value="Field.RowHeaders[i]" Label="@Loc["CBGridRowName"]" Variant="Variant.Outlined" /></td>

                    }
                    @foreach (int j in Enumerable.Range(0, Field.Columns))
                    {
                        <td>
                            <input type="checkbox" @bind="Field.GridState[i][j]" />
                        </td>
                    }
                </tr>
            }
        </table>
    </div>
}
else
{
    <b><span class="CreatureCustomFieldRendererFieldTitle">@Field.Title</span></b>
    <div style="padding:10px;">
        <table>
            @if (Field.HasColumnHeaders)
            {
                <tr>
                    @if (Field.HasRowHeaders)
                    {
                        <td>&nbsp;</td>
                    }
                    @foreach (int i in Enumerable.Range(0, Field.ColumnHeaders.Count))
                    {
                        <td><span class="CreatureCustomFieldRendererCheckBoxGridLabels">@Field.ColumnHeaders[i]</span></td>
                    }
                </tr>
            }
            @foreach (int i in Enumerable.Range(0, Field.Rows))
            {
                <tr>
                    @if (Field.HasRowHeaders)
                    {
                        <td><span class="CreatureCustomFieldRendererCheckBoxGridLabels">@Field.RowHeaders[i]</span></td>
                    }
                    @foreach (int j in Enumerable.Range(0, Field.Columns))
                    {
                        <td style="padding:3px;">
                            <input type="checkbox" @bind="Field.GridState[i][j]" />
                        </td>
                    }
                </tr>
            }
        </table>
    </div>
}

@code {
    [Parameter]
    public DCCreatureCheckboxGridField Field { get; set; } = default!;
    [Parameter]
    public bool EditionMode { get; set; } = false;
    [Parameter]
    public EventCallback OnChange { get; set; }

    private void NotifyParentOnChange()
    {
        if (OnChange.HasDelegate)
        {
            OnChange.InvokeAsync();
        }
    }
}
