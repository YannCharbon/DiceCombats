@*
 * DiceCombats - Copyright (C) 2025 Yann Charbon
 * SPDX-License-Identifier: GPL-3.0-or-later
 *
 * This file is part of DiceCombats, released under the GNU GPL v3.
 * See the LICENSE file in the repository root for details.
*@

@using DiceCombats
@using MudBlazor.Utilities
@inject DiceCombatsService CombatService
@inject IStringLocalizer<Resources.Localization.CreatureCustomFieldRenderer> Loc

<style>
    .CreatureCustomFieldRendererFieldTitle {
    padding:10px;
    font-weight:700;
    }

    .CreatureCustomFieldRendererCheckBoxGridLabels {
    font-size:10pt;
    padding: 4px;
    }

    .DnDConditionsFieldItem {
    border-radius: 100px;
    padding: 5px;
    display: flex; /* Enables Flexbox */
    align-items: center; /* Aligns content vertically */
    justify-content: center; /* Aligns content horizontally (optional) */
    text-align: center;
    font-weight: 400;
    font-size: 18px;
    box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
    }

    .CreatureCustomFieldRendererFieldLabel label {
    background-color: #004D40;
    color: white;
    padding: 2px;
    border-radius: 4px;
    }

    .CreatureCustomFieldRendererFieldBackground {
    background-color: #4A4A5A;
    border-radius:4px;
    }
</style>

@if (EditionMode)
{
    <MudGrid>
        <MudItem sm="4">
            <MudTextField Immediate="true" @bind-Value="Field.Title" Label="@Loc["FieldNameLabel"]" Variant="Variant.Outlined" />
        </MudItem>
        <MudItem sm="4">
            @if (CombatService.GetUserCreatureCustomFieldByName(Field.Title) == null)
            {
                <MudButton OnClick="@(() => CombatService.AddUserCreatureCustomField(Field))" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.PersonAddAlt1" Color="@Color.Primary" Size="Size.Large">@Loc["CustomFieldBtn"]</MudButton>
            } else
            {
                <MudButton OnClick="@(() => CombatService.RemoveUserCreatureCustomFieldByName(Field.Title))" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.PersonRemove" Color="@Color.Error" Size="Size.Large">@Loc["CustomFieldBtn"]</MudButton>
            }
        </MudItem>
        <MudItem sm="2">
            <MudCheckBox @bind-Value="Field.SharedAcrossCreatureInstances" Label="@Loc["SharedField"]" Variant="Variant.Outlined" />
        </MudItem>
    </MudGrid>
}

@if (Field is DCCreatureHitPointsField hitPointsField)
{
    <CCFHitPointsField Field="hitPointsField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureNumericField numericField)
{
    <CCFNumericField Field="numericField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureTextField textField)
{
    <CCFTextField Field="textField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureTextGridField textGridField)
{
    <CCFTextGridField Field="textGridField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureCheckboxField checkBoxField)
{
    <CCFCheckboxField Field="checkBoxField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureCheckboxGridField checkboxGridField)
{
    <CCFCheckboxGridField Field="checkboxGridField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureColorField colorField)
{
    <CCFColorField Field="colorField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureConditionsField dndConditionsField)
{
    <CCFConditionsField Field="dndConditionsField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureStatsField statsField)
{
    <CCFStatsField Field="statsField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}
else if (Field is DCCreatureDetailedPopupField detailedPopupField)
{
    <CCFDetailedPopupField Field="detailedPopupField" EditionMode="EditionMode" OnChange="NotifyParentOnChange" />
}

@code {
    [Parameter]
    public DCCreatureCustomField Field { get; set; } = default!;
    [Parameter]
    public bool EditionMode { get; set; } = false;
    [Parameter]
    public EventCallback OnChange { get; set; }

    private void NotifyParentOnChange()
    {
        if (OnChange.HasDelegate)
        {
            OnChange.InvokeAsync();
        }
    }

}
